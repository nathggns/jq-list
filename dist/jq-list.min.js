/*! jQuery List - v0.1.2 - 2013-04-05
* https://github.com/nathggns/jq-list
* Copyright (c) 2013 Nathaniel Higgins; Licensed MIT */
(function(e,t,n,r,i){"use strict";var s={},o={},u={rows:[],element:null,template:function(){},template_html:"",children:[],events:{},count:1,templates:{},original:{html:"",attrs:{},data:{}}},a={},f=function(e){var t=[i];return function(){for(var n;t.indexOf(n)>-1;n=Math.floor(Math.random()*Math.pow(10,e||10)));return n}}(),l=function(e){var t={add:function(e,t){this.add(t-1),this.render()},"delete":function(e,t){this["delete"](t-1),this.render()}},i={init:function(t,r){r||(r={});if(!e.data("ran")){var i={html:e.html(),attrs:n.extend(!0,{},this.attrs(e.get(0))),data:n.extend(!0,{},e.data())};r.events&&n.each(r.events,function(e,t){typeof t=="function"&&(r.events[e]=[t])});var s=n.extend(!0,{},u,{element:e,original:i},r||{});this.saveInformation(s);if(s.children){var o=[];n.each(s.children,function(e,t){typeof t=="string"&&(t={selector:t}),t.name||(t.name=e),t.options||(t.options={}),t.element=n(t.selector),o.push(t)}),s.children=o}n.each(s.templates,function(e,t){a[e]=l.compileTemplate(t)}),this.setTemplate(n(t));for(var f=0,c=s.count;f<s.count;f++)this.add(f)}this.render(),e.data("ran",!0),this.events("init")},compileTemplate:function(e){return e=this.giveAttrs(e),function(t){e=l.runOnString(e,function(e){var n=e.find("[data-content]");if(n.length>0){var r=t.html();n.after(r),n.remove()}}),t.after(e),t.remove()}},runOnString:function(e,t){typeof e!="string"&&(e=e.html());var r=n("<div/>").html(e);return t(r),r.html()},giveAttrs:function(e){var t=!1,r=this.getKey();typeof e=="string"&&(e=n("<div/>").html(e),t=!0);var i=e.find("[value], input, button, textarea, select").each(function(e){n(this).attr("data-identifier","{{ item.identifier }}-"+e)});return i=i.add(e.find("[data-role]")).each(function(){n(this).attr("data-parent",r)}),i.add(e.find("[data-sublist]")).each(function(){n(this).attr("data-index","{{ loop.index }}"),n(this).attr("data-parent-identifier","{{ item.identifier }}")}),t&&(e=e.html()),e},add:function(e){this.events("before_add");var t=this.getInformation(),r=n.extend(!0,{},o);r.identifier=this.getKey()+"-"+f(),t.rows.splice(e+1,0,r),this.saveInformation(t),this.events("add",e)},"delete":function(e){this.events("before_delete",e);var t=this.getInformation();t.rows.splice(e,1),this.saveInformation(t),this.events("delete",e)},render:function(r){this.events("before_render");var i=this.getInformation(),s=i.children,o={},u={},a=i.rows,f=n.map(a,function(e){return e.identifier});n.each(s,function(t,r){var i=e.find('[data-sublist="'+r.name+'"]');i.each(function(){var e=n(this),t=!1;e.data("ran")||e.list(r.element,r.options);var i=f.indexOf(e.data("parent-identifier"));if(i===-1)return;a[i].child={rows:e.list("getInformation").rows,string:'[data-sublist="'+r.name+'"][data-parent-identifier="'+e.data("parent-identifier")+'"]',info:r}})}),e.find("[data-identifier]").each(function(){u[n(this).data("identifier")]=this}),e.html(i.template(n.extend(!0,{},{list:a,length:a.length,showdelete:a.length>1},r||{},i.render_options||{}))),this.events("render_before_fix"),e.find("[data-role]").on("click",function(e){var r=n(this),i=r.data("role");if(r.data("has-assigned"))return;r.data("has-assigned",!0),t[i]&&(e.preventDefault(),t[i].call(l,e,r.data("index")))}),n.each(s,function(t,r){var i=e.find('[data-sublist="'+r.name+'"]').filter(function(){return!n(this).data("ran")});i.each(function(){n(this).list(r.element,r.options)})}),n.each(a,function(t,n){if(n.child){var r=e.find(n.child.string);if(r.data("ran")){var i=r.list("getInformation");i.rows=n.child.rows,r.list("saveInformation",i).list("render")}}}),n.each(u,function(t,r){var i=e.find('[data-identifier="'+t+'"]'),s=n(r);i.length>0&&(n.each(l.attrs(i[0]),function(e,t){e!=="type"&&s.attr(e,t)}),s.insertAfter(i),i.remove())}),i.rows=a,this.saveInformation(i),this.events("render")},getInformation:function(){return s[this.getKey()]},getKey:function(){return e.data("info-key")||e.data("info-key",f()),e.data("info-key")},saveInformation:function(e){this.events("save_info",e),s[this.getKey()]=e},attrs:function(t){t=t||e;var r={};return n.each(t.attributes,function(){r[this.nodeName]=this.nodeValue}),r},events:function(){if(arguments.length>0){var t=arguments[0],r=this.getInformation(),i=Array.prototype.slice.call(arguments,1);r&&r.events[t]&&n.each(r.events[t],function(){this.apply(e,i)})}},on:function(e,t){var n=this.getInformation();n.events[e]||(n.events[e]=[]),n.events[e].push(t),this.saveInformation(n)},off:function(e,t){var n=this.getInformation();if(n.events[e]){var r=n.events[e].indexOf(t);r>-1&&n.events[e].splice(r,1)}this.saveInformation(n)},methodRunner:function(){return l},reset:function(){var t=this.getKey(),r=this.getInformation();delete s[t],n.each(e.data(),function(t){e.removeData(t)}),n.each(r.original.data,function(t,n){e.data(t,n)}),n.each(this.attrs(e[0]),function(t){t!=="type"&&e.removeAttr(t)}),n.each(r.original.attrs,function(t,n){t!=="type"&&e.attr(t,n)}),e.html(r.original.html)},getTemplate:function(e){var t=this.getInformation();return typeof e=="undefined"?t.template_html:t.template},setTemplate:function(e){typeof e!="string"&&(e=e.html()),e=this.giveAttrs(e);var t=n("<div/>").html(e),i,s=function(e){e.each(function(){var e=n(this),t=e.data("template"),r=a[t];r(e)})};while((i=t.find("[data-template]")).length>0)s(i);e=t.html();var o=this.getInformation();o.template_html=e,o.template=r.compile(e),this.saveInformation(o)}},l=function(){var e=Array.prototype.shift.call(arguments);return i[e].apply(l,arguments)};return n.each(i,function(e){l[e]=function(){Array.prototype.unshift.call(arguments,e);var t=arguments;return l.apply(l,t)}}),l},c=function(){arguments.length<1&&Array.prototype.push.call(arguments,"init");var e=Array.prototype.splice.call(arguments,0,1)[0];return[e,arguments]};n.list=l(!1),n.fn.list=function(){var e=c.apply(this,arguments),t=e[0],n=e[1];if(!this.data("ran")){var r;t!=="init"&&(Array.prototype.unshift.call(n,t),t="init"),n.length<1?r='[type="text/swig"]':(r=n[0],Array.prototype.splice.call(n,0,1)),Array.prototype.unshift.call(n,r)}var i=l(this)[t].apply(this,n);return i?i:this}})(window,document,jQuery,swig);